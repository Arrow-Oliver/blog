---
title: "Computer Network"
date: 2024-11-18T23:02:57+08:00
draft: false
categories: [_Misc]
tags: []
card: false
weight: 0
---

# 互联网协议

## 五层协议

| 五层协议                    |
| --------------------------- |
| 应用层（Application Layer） |
| 传输层（Transport Layer）   |
| 网络层（Network Layer）     |
| 链接层（Link Layer）        |
| 实体层（Physical Layer）    |

> 越往下越涉及（物理）底层，越往上越对应用户。

## 层与协议

每一层都是为了完成一种功能。为了实现这些功能，就需要大家都遵守共同的规则。

大家都遵守的规则，就叫做"协议"（protocol）。

## 实体层

实体层的功能是把电脑连接起来的物理手段。它主要规定了网络的一些电气特性，作用是负责传送0和1的电信号。

用到的方式有：光缆、电缆、双绞线、无线电波等。

## 链接层

1. 单纯的0和1是没有意义的，如何组装，解析电信号是链接层所解决的问题。

这就是"链接层"的功能，它在"实体层"的上方，确定了0和1的分组方式。

**以太网协议**（链接层的实现协议）

以太网协议是实现了电信号分组方式，并被当前互联网所采纳。

以太网规定，一组电信号构成一个数据包，叫做"帧"（Frame）。每一帧分成两个部分：标头（Head）和数据（Data）。

| 标头 | 数据 |
| :--- | ---- |
| Head | Data |

"标头"包含数据包的一些说明项，比如发送者、接受者、数据类型等等；"数据"则是数据包的具体内容。

"标头"的长度，固定为18字节。"数据"的长度，最短为46字节，最长为1500字节。因此，整个"帧"最短为64字节，最长为1518字节。如果数据很长，就必须分割成多个帧进行发送。

**MAC地址**

1. 以太网数据包的"标头"，包含了发送者和接受者的信息。那么，发送者和接受者是如何标识呢？

以太网规定，连入网络的所有设备，都必须具有"网卡"接口。数据包必须是从一块网卡，传送到另一块网卡。网卡的地址，就是数据包的发送地址和接收地址，这叫做MAC地址。

> 可以理解为MAC地址为每台计算机的身份证号，唯一性。

**广播**

1. 一块网卡怎么会知道另一块网卡的MAC地址？

回答是有一种**ARP协议**，可以解决这个问题。这里我们知道以太网数据包必须知道接收方的MAC地址，然后才能发送。

2. 其次，就算有了MAC地址，系统怎样才能把数据包准确送到接收方？

回答是以太网采用了一种很"原始"的方式，它不是把数据包准确送到接收方，而是向本网络内所有计算机发送，让每台计算机自己判断，是否为接收方。

举例：1号计算机向2号计算机发送一个数据包，同一个子网络的3号、4号、5号计算机都会收到这个包。接收方读取这个包的"标头"，找到接收方发送连接的MAC地址，然后与自身的MAC地址相比较，如果两者相同，就接受这个包，做进一步处理，否则就丢弃这个包。这种发送方式就叫做"广播"（broadcasting）。

## 网络层

1. 以太网只是做到了同一个网段内的数据发送，那么如果我想在上海发送数据到洛阳，那么这两个地方肯定不是在同一个网段内，通过以太网的广播肯定是无法传输的。

因此，必须找到一种方法，能够区分哪些MAC地址属于同一个子网络，哪些不是。如果是同一个子网络，就采用广播方式发送，否则就采用"路由"方式发送。

这就导致了"网络层"的诞生。它的作用是引进一套新的地址，使得我们能够区分不同的计算机是否属于同一个子网络。这套地址就叫做"网络地址"，简称"网址"。

于是，"网络层"出现以后，每台计算机有了两种地址，一种是MAC地址，另一种是网络地址。两种地址之间没有任何联系，MAC地址是绑定在网卡上的，<u>是唯一的</u>，而网络地址则是管理员分配的，它们只是随机组合在一起，<u>在同一网段是唯一的，但是在不同网段是可以重复的。</u>

网络地址帮助我们确定计算机所在的子网络，MAC地址则将数据包送到该子网络中的目标网卡。因此，从逻辑上可以推断，必定是先处理网络地址，然后再处理MAC地址。

**IP协议**（网络层的实现协议）

互联网上的每一台计算机，都会分配到一个IP地址。这个地址分成两个部分，前一部分代表网络，后一部分代表主机。

1. 那么，怎样才能从IP地址，判断两台计算机是否属于同一个子网络呢？

这就要用到另一个参数"子网掩码"（subnet mask）。

比如，IP地址172.16.254.1，如果已知网络部分是前24位，主机部分是后8位，那么子网络掩码就是11111111.11111111.11111111.00000000

总结一下，IP协议的作用主要有两个，一个是为每一台计算机分配IP地址，另一个是确定哪些地址在同一个子网络。

**ARP协议**

1. 因为IP数据包是放在以太网数据包里发送的，所以我们必须同时知道两个地址，一个是对方的MAC地址，另一个是对方的IP地址。通常情况下，对方的IP地址是已知的（后文会解释），但是我们不知道它的MAC地址。所以，我们需要一种机制，能够从IP地址得到MAC地址。

这里又可以分成两种情况。

* 第一种情况，如果两台主机不在同一个子网络，那么事实上没有办法得到对方的MAC地址，只能把数据包传送到两个子网络连接处的"网关"（gateway），让网关去处理。

* 第二种情况，如果两台主机在同一个子网络，那么我们可以用ARP协议，得到对方的MAC地址。ARP协议也是发出一个数据包（包含在以太网数据包中），其中包含它所要查询主机的IP地址，在对方的MAC地址这一栏，填的是FF:FF:FF:FF:FF:FF，表示这是一个"广播"地址。它所在子网络的每一台主机，都会收到这个数据包，从中取出IP地址，与自身的IP地址进行比较。如果两者相同，都做出回复，向对方报告自己的MAC地址，否则就丢弃这个包。

> 链接层协议，只能获取到同一网段的子网MAC地址，如果存在其他网段的子网只能通过网关的MAC地址进行间接获取。<u>您只能获取到网关的 MAC 地址，只有网关有目标设备的 MAC 地址。</u>

## 传输层

有了MAC地址和IP地址，我们已经可以在互联网上任意两台主机上建立通信。

1. 接下来的问题是，同一台主机上有许多程序都需要用到网络，比如，你一边浏览网页，一边与朋友在线聊天。当一个数据包从互联网上发来的时候，你怎么知道，它是表示网页的内容，还是表示在线聊天的内容？

"传输层"的功能，就是建立"端口到端口"的通信。实现程序之间的交流。 根据端口，保证发送的数据包是指定给对方的哪个程序。

**UDP协议**（传输层的实现协议）

现在，我们必须在数据包中加入端口信息，这就需要新的协议。最简单的实现叫做UDP协议，它的格式几乎就是在数据前面，加上端口号。

**TCP协议**（更安全的实现协议）

1. UDP协议的优点是比较简单，容易实现，但是缺点是可靠性较差，一旦数据包发出，无法知道对方是否收到。

为了解决这个问题，提高网络可靠性，TCP协议就诞生了。这个协议非常复杂，但可以近似认为，它就是有确认机制的UDP协议，每发出一个数据包都要求确认。如果有一个数据包遗失，就收不到确认，发出方就知道有必要重发这个数据包了。

因此，TCP协议能够确保数据不会遗失。它的缺点是过程复杂、实现困难、消耗较多的资源。

## 应用层

1. 应用程序收到"传输层"的数据，接下来就要进行解读。由于互联网是开放架构，数据来源五花八门，必须事先规定好格式，否则根本无法解读。

"应用层"的作用，就是规定应用程序的数据格式。

举例来说，TCP协议可以为各种各样的程序传递数据，比如Email、WWW、FTP等等。那么，必须有不同协议规定电子邮件、网页、FTP<u>数据的格式</u>，这些应用程序协议就构成了"应用层"。

# 总结

网络通信就是交换数据包。电脑A向电脑B发送一个数据包，后者收到了，回复一个数据包，从而实现两台电脑之间的通信。

发送这个包，需要知道两个地址：

* 对方的MAC地址
* 对方的IP地址

有了这两个地址，数据包才能准确送到接收者手中。但是，前面说过，MAC地址有局限性，如果两台电脑不在同一个子网络，就无法知道对方的MAC地址，必须通过网关（gateway）转发。

数据包的目标地址，实际上分成两种情况：

| 场景           | 数据包地址                  |
| -------------- | --------------------------- |
| 同一个子网络   | 对方的MAC地址，对方的IP地址 |
| 非同一个子网络 | 网关的MAC地址，对方的IP地址 |

发送数据包之前，电脑必须判断对方是否在同一个子网络，然后选择相应的MAC地址。

















